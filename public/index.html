<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Web site created using create-react-app" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Jibin Portfolio</title>
    <style>
      #chat-container {
        display: none;
        position: fixed;
        bottom: 60px;
        right: 20px;
        width: 300px;
        background: white;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        cursor: move;
      }
      #chat-messages {
        height: 200px;
        overflow-y: auto;
        padding: 10px;
        font-size: 14px;
      }
      #chat-input {
        width: 80%;
        padding: 5px;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- 💬 Chatbot Widget -->
    <div id="chat-container">
      <div style="padding:10px; border-bottom:1px solid #eee;">JibinBot</div>
      <div id="chat-messages"></div>
      <div style="padding:10px;">
        <input id="chat-input" type="text" placeholder="Ask me anything..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <!-- 💬 Toggle Button -->
    <button onclick="toggleChat()" style="position:fixed; bottom:20px; right:20px; background:#007bff; color:white; border:none; border-radius:20px; padding:10px 15px; font-size:14px; z-index:999;">
      💬 Ask Jibin
    </button>

    <!-- 🤖 JibinBot Logic -->
    <script>
      let isDragging = false, offsetX, offsetY;

      function toggleChat() {
        const chat = document.getElementById("chat-container");
        chat.style.display = (chat.style.display === "none") ? "block" : "none";
      }

      async function sendMessage() {
        const input = document.getElementById("chat-input");
        const message = input.value.trim();
        if (!message) return;

        const chatBox = document.getElementById("chat-messages");
        chatBox.innerHTML += `<div><strong>You:</strong> ${message}</div>`;
        input.value = "";

        const response = await fetch("https://ask-jibin-backend.onrender.com/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message })
        });

        const data = await response.json();
        chatBox.innerHTML += `<div><strong>JibinBot:</strong> ${data.response}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // 🖱️ Drag to move
      const chatContainer = document.getElementById("chat-container");
      chatContainer.addEventListener("mousedown", (e) => {
        isDragging = true;
        offsetX = e.clientX - chatContainer.offsetLeft;
        offsetY = e.clientY - chatContainer.offsetTop;
      });

      document.addEventListener("mousemove", (e) => {
        if (isDragging) {
          chatContainer.style.left = `${e.clientX - offsetX}px`;
          chatContainer.style.top = `${e.clientY - offsetY}px`;
        }
      });

      document.addEventListener("mouseup", () => isDragging = false);
    </script>
  </body>
</html>
